// Generated by CoffeeScript 1.7.1
(function() {
  var async, express, formateTime, http, router;

  express = require('express');

  http = require('http');

  async = require('async');

  require('date-utils');

  router = express.Router();

  formateTime = function(second) {
    return [parseInt(second / 60 / 60), second / 60 % 60, second % 60].join(":").replace(/\b(\d)\b/g, "0$1");
  };

  router.get('/', function(req, res) {
    var getInfoDirect, tasks;
    getInfoDirect = function(path) {
      return function(callback) {
        return http.get('http://127.0.0.1:9085' + path, function(res) {
          return res.on('data', function(data) {
            return callback(null, data.toString());
          });
        });
      };
    };
    tasks = {
      status: getInfoDirect('/qora/status'),
      blockHeight: getInfoDirect('/blocks/height'),
      isUpToDate: getInfoDirect('/qora/isuptodate'),
      peers: getInfoDirect('/peers'),
      blockTime: getInfoDirect('/blocks/time'),
      generatingBalance: getInfoDirect('/blocks/generatingbalance'),
      trasactionsNet: getInfoDirect('/transactions/network'),
      blockLast: getInfoDirect('/blocks/last')
    };
    return async.parallel(tasks, function(err, results) {
      if (err) {
        res.render('index', {
          title: 'error',
          err: true
        });
        return;
      }
      results.blockLast = eval('(' + results.blockLast + ')');
      results.blockTime = new Date(Number(results.blockLast.timestamp) + Number(results.blockTime) * 1000).toFormat('YYYY-MM-DD HH24:MI:SS');
      results.blockLast.timestamp = new Date(results.blockLast.timestamp).toFormat('YYYY-MM-DD HH24:MI:SS');
      return res.render('index', {
        title: "Qora Monitor",
        message: results,
        err: false
      });
    });
  });

  module.exports = router;

}).call(this);

//# sourceMappingURL=index.map
