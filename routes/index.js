// Generated by CoffeeScript 1.7.1
(function() {
  var async, express, http, router;

  express = require('express');

  http = require('http');

  async = require('async');

  require('date-utils');

  router = express.Router();

  router.get('/', function(req, res) {
    var getInfoDirect, tasks;
    getInfoDirect = function(path) {
      return function(callback) {
        var get;
        get = http.get('http://127.0.0.1:9085' + path, function(res) {
          return res.on('data', function(data) {
            return callback(null, data.toString());
          });
        });
        return get.on('error', function(err) {
          return callback(err);
        });
      };
    };
    tasks = {
      status: getInfoDirect('/qora/status'),
      blockHeight: getInfoDirect('/blocks/height'),
      isUpToDate: getInfoDirect('/qora/isuptodate'),
      peers: getInfoDirect('/peers'),
      blockTime: getInfoDirect('/blocks/time'),
      generatingBalance: getInfoDirect('/blocks/generatingbalance'),
      blockLast: getInfoDirect('/blocks/last')
    };
    return async.parallel(tasks, function(err, results) {
      if (err) {
        res.render('index', {
          title: 'error',
          message: "Get info failed , Plea make sure you have start the qora without -disablerpc ",
          err: true
        });
        return;
      }
      results.blockLast = eval('(' + results.blockLast + ')');
      results.peers = eval('(' + results.peers + ')');
      results.blockLast.timestamp = new Date(results.blockLast.timestamp).toFormat('YYYY-MM-DD HH24:MI:SS');
      return res.render('index', {
        title: "Qora Monitor",
        message: results,
        err: false
      });
    });
  });

  module.exports = router;

}).call(this);

//# sourceMappingURL=index.map
